{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
        <title>Detail Recipe</title>
        <link rel="stylesheet" type="text/css" href="{% static 'nutrihacker/style.css' %}">
        <style>
			* {
				box-sizing: border-box;
			}
            h1, h2 {
                color: white;
                text-align: center;
            }

            label {
                color: white;
                text-align: right;
                margin-right: 10px;
            }
            input, select {
                width: revert;
                padding: revert;
                margin: revert;
            }
            table, td, th{
            	border: 1px solid black;
            }
            table{
            	border-collapse: collapse;
            }
            th {
                text-align: right;
            }
            td {
                color: black;
                text-align: left;
            }
            .addbtn{
                border-radius:90%;
                cursor: pointer;
            }
            .addbtn:hover{
                 background-color: green;
            }
            .row1{
                font-size: 40px;
            }
            .row2{
                text-decoration-line: underline;
                text-decoration-style: double;
            }
            .portionbtn{
                cursor: pointer;
                padding: 0px 5px;
            }
            .sbmtbtn{
                font-size: 22px;
                cursor: pointer;
            }
            .sbmtbtn:hover{
                background-color: green;
            }

			table.facts-1 {
  			margin-left: auto;
  			margin-right: auto;
  			margin-top: auto;
  			margin-bottom: auto;
			}
			table.facts-2 {
  			background-color: white;
  			margin-left: auto;
  			margin-right: auto;
  			width:25%;
			}
			.boxcolumn-1 {
				padding: 10px;
				height: 300px;

			}


			.boxcolumn-2 {
				padding: 10px;
				height: 300px;
			}
			.boxrow:after {
				  content: "";
				  display: table;
				  clear: both;
			}
			hr{
        		background-color: none;
        		border: none;
    		}
        </style>
        <script type="text/javascript">

        </script>
    </head>
    <body>
        {% include "nutrihacker/navigation_bar.html" %}
        <h1>Recipe Details</h1>
		{% if user == recipe.user %}
		<!-- Buttons to update or delete recipe -->
		<div style="text-align:center">
		<br>
			<a href="{% url 'nutrihacker:update_recipe' recipe.id %}" style="text-align:center" ><button class="B" style="text-align:center">Update Recipe</button></a>
			<form action="{% url 'nutrihacker:delete_recipe' recipe.id %}" method="POST">
				{% csrf_token %}
				<input type="hidden" name="id" value={{ recipe.id }}>
				<button class="B" type="submit" style="text-align:center">Delete Recipe</button></a>
			</form>
		</div>
		{% endif %}
		<br>
        <h2>Here is your recipe!</h2>
	<div class="boxcolumn-1">
		<table class="facts-1" style="background-color: white;">
			<tr>
				<th style="text-align: center;"colspan="5">{{ recipe.name }}</th>
			</tr>
			<tr>
				<td>PRODUCES:</td>
				<td colspan="4" style="text-align:center;">{{ recipe.servingsProduced }} servings</td>
			</tr>
			<tr>
				<td>INSTRUCTIONS:</td>
				<td colspan="4"style="text-align:center;">{{ recipe.instruction|linebreaksbr }}</td>
			</tr>
			<tr>
				<td>INGREDIENTS</td>

			{% for recipe_food in ingredients %}
				<td>
				<!--{{ recipe_food.food.name }} -->
				<br>{{ recipe_food.portions }}g of <a href="{% url 'nutrihacker:nutrifacts' recipe_food.food.id %}"><button class="B">{{ recipe_food.food.name }}</button></a><br>
				</td><br>
				{% endfor %}
			</tr>
		</table>
	</div>
	<div class="boxcolumn-2">
		<h1 style="color: white; margin-top: 150px;"><center>Nutrition Facts:</center></h1>
		<form action="{% url 'nutrihacker:detail_recipe' recipe.id %}" method="GET">
			<center>
				<label style="color: white">Number of portions: </label>
				<input type="number" name="portions" step="any" min="0" max="99" value="{{ portions }}">
				<button type="submit" value="Submit">Calculate</button>
			</center>
			<br>
		</form>
		<table class="facts-2">
			<tr>
				<td>Calories</td>
				<td class="right">{{ nutrition.calories|floatformat }}</td>
			</tr>
			<tr>
				<td>Total Fat</td>
				<td class="right">{{ nutrition.totalFat|floatformat }}g</td>
			</tr>
			<tr>
				<td>Cholesterol</td>
				<td class="right">{{ nutrition.cholesterol|floatformat }}mg</td>
			</tr>
			<tr>
				<td>Sodium</td>
				<td class="right">{{ nutrition.sodium|floatformat }}mg</td>
			</tr>
			<tr>
				<td>Total Carbohydrates</td>
				<td class="right">{{ nutrition.totalCarb|floatformat }}g</td>
			</tr>
			<tr>
				<td>Protein</td>
				<td class="right">{{ nutrition.protein|floatformat }}g</td>
			</tr>

		</table>
		<table style="background-color: white; margin-left: auto; margin-right: auto;">
				<hr>
			<tr>
				<td colspan="3" style="text-align:center; font-weight: bold;">Additional Diet Information</td>
			</tr>
			<tr>
				<td>Allergy Information  </td>
				<td>{{ recipe.allergy }}</td>
			</tr>
			<tr>
				<td>Diet Information  </td>
				<td>{{ recipe.diet }}</td>
			</tr>
		</table>
	</div>
	</table>
    </body>
    <script type="text/javascript">
        var extra_count = Number(document.getElementById("id_extra_field_count").value);
        var food_number = 2;
        
        // adds another food and portions field to the form
        function addAnotherFood() {
            // get the table
            var table = document.getElementById("formtable");
            // get all table rows
            var rows = table.getElementsByTagName("tr");
            
            // select rows 3 and 4 (original food and portions field)
            var f_row = rows[2];
            var p_row = rows[3];
            
            // clone the rows
            var f_clone = f_row.cloneNode(true);
            var p_clone = p_row.cloneNode(true);
            
            // remove the hidden element
            p_clone.getElementsByTagName("input")[1].remove();

            // get the label and select elements from the food row
            var f_label = f_clone.getElementsByTagName("label")[0];
            var f_select = f_clone.getElementsByTagName("select")[0];
            
            // get the label and input elements from the portions row
            var p_label = p_clone.getElementsByTagName("label")[0];
            var p_input = p_clone.getElementsByTagName("input")[0];

            // set the for, name, and id
            f_label.setAttribute("for", "id_food" + food_number);
            f_select.setAttribute("name", "food" + food_number);
            f_select.id = "id_food" + food_number;

            // repeat for portions, initialize value to 1
            p_label.setAttribute("for", "id_portions" + food_number);
            p_input.setAttribute("name", "portions" + food_number);
            p_input.id = "id_portions" + food_number;
            p_input.value = 1;

            // append rows to the table
            table.appendChild(f_clone);
            table.appendChild(p_clone);

            // increment counters
            food_number++;
            extra_count++;

            // update hidden value
            document.getElementById("id_extra_field_count").value = extra_count;
        }
    </script>
</html>