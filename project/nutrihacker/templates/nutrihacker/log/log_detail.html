{% load static %}

<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="UTF-8">
	    <title>Log Details</title>
		<link rel="shortcut icon" type="image/png" href="{% static 'nutrihacker/images/favicon.png' %}">
	    <link rel="stylesheet" type="text/css" href="{% static 'nutrihacker/style.css' %}">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<style>
			.detailtable {
				border-collapse: collapse;
				border: 1px solid black;
				border-right: 0px;
				width: 90%;
				background-color: white;
				border-spacing: 0;
			}
			.detailtable th {
				border-collapse: collapse;
				padding: 2px;
				border: 1px solid black;
			}
			.detailtable td {
				border-collapse: collapse;
				border: 1px solid black;
				border-right: 0px;
			}
			tr.teal {
				background-color: #009879;
				color: #ffffff;
			}
			.facts {
				width: 35%;
				margin: auto;
				font-size: 24px;
			}
			.right {
				text-align: right;
				width: 9%;
			}
			.btntable {
				width: 90%;
				margin-bottom: 0;
			}
			.topbtn {
				padding: 5px;
				font-size: 15px;
				border-radius:12px;
			}
			a {
				text-decoration: none;
				align: center;
			}
			a:hover {
				color: blue;
			}
			input {
				width: 48px;
			}
			label {
				color: white;
			}
			form {
				display: inline;
			}
			span {
				font-size: 18px;
			}
			.btn {
				font-size: 20px;
				text-align: right;
			}
			/* Popup container */
			.popup {
				position: relative;
				display: inline-block;
				cursor: pointer;
			}

			/* The actual popup (appears on top) */
			.popup .popuptext {
				visibility: hidden;
				width: 160px;
				background-color: #555;
				color: #fff;
				text-align: center;
				border-radius: 6px;
				padding: 8px 0;
				position: absolute;
				z-index: 1;
				bottom: 125%;
				left: 50%;
				margin-left: -80px;
			}

			/* Popup arrow *
			.popup .popuptext::after {
				content: "";
				position: absolute;
				top: 100%;
				left: 50%;
				margin-left: -5px;
				border-width: 5px;
				border-style: solid;
				border-color: #555 transparent transparent transparent;
			}*/

			/* Toggle this class when clicking on the popup container (hide and show the popup) */
			.popup .show {
				visibility: visible;
				-webkit-animation: fadeIn 0.5s;
				animation: fadeIn 0.5s
			}

			/* Add animation (fade in the popup) */
			@-webkit-keyframes fadeIn {
				from {opacity: 0;}
				to {opacity: 1;}
			}

			@keyframes fadeIn {
				from {opacity: 0;}
				to {opacity:1 ;}
			}
		</style>
	</head>
	<body>
		{% include "nutrihacker/navigation_bar.html" %}

		<p>Overview for {{ dailylog.date }}</p>
		<table class="btntable" align="center">
			<tr>
				<td style="text-align: left">
					<a href="{% url 'nutrihacker:log_list' %}"><button class="topbtn">&#9204; Back to My Logs&nbsp;</button></a>
				</td>
				<td style="text-align: right">
					<form action="{% url 'nutrihacker:log_create' %}" method="GET">
						<button type="submit" class="topbtn" name="date" value="{{ dailylog.date|date:'Y-m-d' }}">
							<b>+</b>&nbsp;&nbsp;Add a Meal&nbsp;
						</button>
					</form>
				</td>
			</tr>
		</table>
		<br><br>
		<table class="detailtable" align="center">
			{% if info_list %}
			<tr class="teal">
				<th colspan="2"></th>
				<th>Amount (g)<br>(Servings)</th>
				<th>Calories<br>(kcal)</th>
				<th>Total Fat<br>(g)</th>
				<th>Cholesterol<br>(mg)</th>
				<th>Sodium<br>(mg)</th>
				<th>Total Carbs<br>(g)</th>
				<th>Protein<br>(g)</th>
				<th colspan="2"></th>
			</tr>
			<tr class="teal">
				<th colspan="2" style="text-align: center">Day Total </th>
				<th class="right">{{ daytotal.servingSize|floatformat }}</th>
				<th class="right">{{ daytotal.calories|floatformat }}</th>
				<th class="right">{{ daytotal.totalFat|floatformat }}</th>
				<th class="right">{{ daytotal.cholesterol|floatformat }}</th>
				<th class="right">{{ daytotal.sodium|floatformat }}</th>
				<th class="right">{{ daytotal.totalCarb|floatformat }}</th>
				<th class="right">{{ daytotal.protein|floatformat }}</th>
				<th colspan="2"></th>
			</tr>
			<tr class="teal">
				<th colspan="11" style="padding-top: 20px; padding-bottom: 10px">Breakdown by meal:</th>
			</tr>
				{% for meallog in info_list %}
				<tr style="background-color: #242424">
					<th style="width: 8%">{{ meallog.time }}</th>
					<th colspan="8"></th>
					<th>
						<a href="{% url 'nutrihacker:log_update' meallog.id %}"><button class="btn">&#9998;</button></a>
					</th>
					<th>
						<div class="popup" id={{ meallog.id }} onclick="confirm(this.id)">
							<span class="popuptext" id="popup{{ meallog.id }}">Are you sure you want to delete?<br>
								<form action="{% url 'nutrihacker:meallog_delete' %}" method="POST">
									{% csrf_token %}
									<input type="hidden" name="id" value={{ meallog.id }}>
									<button type="submit">Yes</button>
								</form><button>No</button>
							</span>
							<button class="btn"><i class="fa fa-trash"></i></button>
						</div>
					</th>
				</tr>
					{% if meallog.item_list %}
						{% for item in meallog.item_list %}
						<tr>
							<th></th>
							<th style="text-align: left"><a href="
								{% if item.type == 'food' %}
									{% url 'nutrihacker:nutrifacts' item.id %}
								{% else %}
									{% url 'nutrihacker:detail_recipe' item.id %}
								{% endif %}
							">{{ item.name }}</a></th>
							<th class="right">{{ item.servingSize|floatformat }} ({{ item.portions }})</th>
							<th class="right">{{ item.calories|floatformat }}</th>
							<th class="right">{{ item.totalFat|floatformat }}</th>
							<th class="right">{{ item.cholesterol|floatformat }}</th>
							<th class="right">{{ item.sodium|floatformat }}</th>
							<th class="right">{{ item.totalCarb|floatformat }}</th>
							<th class="right">{{ item.protein|floatformat }}</th>
						</tr>
						{% endfor %}
					<tr class="teal">
						<th style="background-color: white"></th>
						<th style="text-align: left">Meal Total</th>
						<th class="right">{{ meallog.total.servingSize|floatformat }}</th>
						<th class="right">{{ meallog.total.calories|floatformat }}</th>
						<th class="right">{{ meallog.total.totalFat|floatformat }}</th>
						<th class="right">{{ meallog.total.cholesterol|floatformat }}</th>
						<th class="right">{{ meallog.total.sodium|floatformat }}</th>
						<th class="right">{{ meallog.total.totalCarb|floatformat }}</th>
						<th class="right">{{ meallog.total.protein|floatformat }}</th>
					</tr>
					{% else %}
					<tr>
						<th></th>
						<th colspan="8">There is no information logged for this time</th>
					</tr>
					{% endif %}
				{% endfor %}
			{% else %}
			<tr>
				<th>You have no meals logged for this day</th>
			</tr>
			{% endif %}
		</table>
	</body>
	<script>
		// When the user clicks on <div>, open the popup
		function confirm(clicked_id) {
		  	var popup = document.getElementById("popup"+clicked_id);
		  	popup.classList.toggle("show");
		}
	</script>
</html>